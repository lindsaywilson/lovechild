/* global google, InfoBox */$(document).ready(function(){$(window).on("resize",function(){var e=$(this).height()-43-15,t=$("#content").outerHeight(!0);e<t?e="auto":e+="px";$("#frame").css("height",e)}).load(function(){$(this).trigger("resize")}).trigger("resize");$("#nav .button").each(function(){var e=$(this).text(),t=$(this).find("span.wrap");for(var n=0;n<16;n++){t.append('<span class="shadow">'+e+"</span>");t=t.find("span.shadow")}});if($("#spinbox").length){var e=function(n){clearInterval(t);if(n==="next"){n=$("#indicators li.selected").index()+1;n===$("#indicators li").length&&(n=0)}if($("#slides li.on").index()!==n){$("#slides li:eq("+n+")").addClass("queued");$("#indicators li.selected").removeClass("selected");$("#indicators li:eq("+n+")").addClass("selected");$("#slides li.on").fadeOut(300);$("#slides li.queued").fadeIn(300,function(){$("#slides li.on").removeClass("on").attr("style","");$(this).addClass("on").removeClass("queued").attr("style","");t=setTimeout(function(){e("next")},7e3)})}},t=setTimeout(function(){e("next")},7e3);$("#spinbox #indicators a").on("click",function(t){t.preventDefault();e($(this).closest("li").index())});$(window).on("mousemove",function(e){var t=e.pageX/$(this).width(),n=e.pageY/$(this).height();$("#frame").css("backgroundPosition",-20*t+"px "+30*n+"px");$(".hill").css("margin-bottom",-50*n+"px");$(".hill.large.left").css("margin-left",-100*t+"px");$(".hill.large.right").css("margin-right",-100*(1-t)+"px");$(".hill.small.left").css("margin-left",-50*t+"px");$(".hill.small.right").css("margin-right",-50*(1-t)+"px");$("#banana").css({"margin-left":-150*t+"px","margin-bottom":-75*n+"px"});$("#apricot").css({"margin-right":-200*(1-t)+"px","margin-bottom":-100*n+"px"})}).load(function(){$(this).trigger("mousemove")}).trigger("mousemove")}$("body").hasClass("products");$("body").hasClass("story");if($("body").hasClass("questions")){$("#faqs li h3 a").on("click",function(e){e.preventDefault();$(this).closest("li").find(".answer").slideToggle(function(){$(window).trigger("resize")})});$("#search").on("keyup",function(){var e=$(this).val().toLowerCase();$("#faqs ul li").show().filter(function(){return $(this).find("h3").text().toLowerCase().indexOf(e)===-1}).hide()})}$("body").hasClass("news");$("body").hasClass("nutrition");$(".teaser").length&&$("#content").imagesLoaded().done(function(){$(".teaser").each(function(){var e=$(this).width()/$(this).height(),t=$(this).find("img"),n=t.width()/t.height(),r={};n>e?r={width:$(this).height()*n+"px",height:$(this).height()+"px","margin-left":$(this).height()*n/-2+"px","margin-top":$(this).height()/-2+"px"}:r={width:$(this).width()+"px",height:$(this).width()/n+"px","margin-left":$(this).width()/-2+"px","margin-top":$(this).width()/n/-2+"px"};t.css(r)})});$(".share").length&&$(".share a").on("click",function(e){e.preventDefault();window.open($(this).attr("href"),"_blank","width=640,height=480")});if($(".box.intro").length){var n=0;$(window).on("scroll",function(e){var t=$(this).scrollTop();$(".box.intro").css("opacity",1-t/173);$(".box.first").css("margin-top",n*Math.max(0,Math.min(1,1-t/173))+"px")}).load(function(){n=$(".box.intro").outerHeight(!0);$(this).trigger("scroll")}).trigger("scroll")}if($("#sidebar").length){var r=$("#sidebar").hasClass("brushed");if(r){var i=[];$("#sidebar a").on("click",function(e){e.preventDefault();$("body,html").animate({scrollTop:i[$(this).closest("li").index()]-171+"px"},1e3)})}$(window).on("resize",function(e){$("#sidebar").css("height",$(this).height()-21-83+"px")}).on("scroll",function(e){var t=$(this).scrollTop();t>21?$("#sidebar").addClass("locked"):$("#sidebar").removeClass("locked");if(r){$("#sidebar li").removeClass("on");var n=0;for(var s=0;s<i.length;s++)t>i[s]-173&&(n=s);$("#sidebar li:eq("+n+")").addClass("on")}}).load(function(){if(r){var e=$(".box.intro").outerHeight(!0);$(".box:not(.intro)").each(function(){i.push($(this).offset().top-e)})}$("#content").css("min-height",$("#sidebar").height()+"px");$(this).trigger("scroll").trigger("resize")}).trigger("scroll").trigger("resize");$("#sidebar #archive").length&&$("#archive a.year").on("click",function(e){e.preventDefault();$("#archive ul ul").hide();$(this).closest("li").find("ul").show()})}if($("#map").length){var s=new google.maps.Geocoder,o=new google.maps.Map(document.getElementById("map-canvas"),{zoom:14}),u=new google.maps.InfoWindow({content:'<div id="infowindow"></div>'}),a=new InfoBox({boxClass:"infobox",pixelOffset:new google.maps.Size(-357,-38),closeBoxURL:window.template_url+"/images/marker/blank.png",closeBoxMargin:"-14px -16px 0 0",isHidden:!1,enableEventPropagation:!1}),f=[],l=[],c=[],h=function(e,t){return Math.abs(e-t)},p=function(){for(var e=0;e<c.length;e++)c[e].setMap(null);c=[];var t="";for(var n=0;n<l.length;n++){var r=new google.maps.Marker({position:new google.maps.LatLng(l[n].lat,l[n].lon),map:o,html:"<h3>"+l[n].name+"</h3><p>"+l[n].address+'</p><a href="https://www.google.ca/maps/place/'+encodeURIComponent(l[n].address)+'" target="_blank" class="gmap">View in Google Maps</a>',icon:{url:window.template_url+"/images/marker/marker-"+(n+1)+".png",size:new google.maps.Size(37,39),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,37)}});c.push(r);google.maps.event.addListener(r,"click",function(){a.content_=this.html;a.open(o,this)});t+='<li><a href="#">'+l[n].name+"</a></li>"}t===""&&(t="No nearby retailers");$("#retailers ol").html(t)},d=function(){var e=o.getBounds();l=[];for(var t=0;t<f.length;t++)e.contains(new google.maps.LatLng(f[t].lat,f[t].lon))&&($("#retailers #search").val()!==""?f[t].name.toLowerCase().indexOf($("#retailers #search").val().toLowerCase())>-1&&l.push(f[t]):l.push(f[t]));l=l.slice(0,30)};$.getJSON("http://freegeoip.net/json/",function(e){var t=new google.maps.LatLng(e.latitude,e.longitude);o.setCenter(t);f=window.retailers;d();p()});google.maps.event.addListener(o,"center_changed",function(){d();p()});$("a#locate").on("click",function(e){e.preventDefault();navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);o.setCenter(t);s.geocode({location:t},function(e,t){for(var n=0;n<e.length;n++)e[n].types.indexOf("locality")>-1&&e[n].types.indexOf("political")>-1&&$("a#locate").text(e[n].formatted_address)})}):$("a#locate").text("Geolocation not supported")});$("#locator form").on("submit",function(e){e.preventDefault();var t=$(this).find("#locale").val();s.geocode({address:t},function(e,t){o.setCenter(e[0].geometry.location);o.setZoom(14)})});$("#retailers #search").on("keyup",function(e){var t=$(this).val();$("#retailers ol li").show().filter(function(){return $(this).text().indexOf(t)===-1}).hide();$("#retailers ol li:visible").length?$("#noResults").hide():$("#noResults").show();d();p()});$(".stores ul").each(function(){var e=$(this),t=0;e.imagesLoaded().done(function(n){e.find("li").each(function(){t+=$(this).outerWidth(!0)});if(t>e.width()){e.parent().find(".grad").show();var r=e.width()-t;e.on("mousemove",function(t){var n=t.originalEvent.layerX/e.width();e.find("li:first").css("margin-left",r*n+"px")})}})});$(document).on("click","#retailers a",function(e){e.preventDefault();google.maps.event.trigger(c[$(this).closest("li").index()],"click")})}$("#fruit").length&&$("#fruit a").on("mouseenter",function(){$(this).siblings("a").addClass("faded");$("#fruit #fact").html("<h3>"+$(this).find("img").attr("alt")+"</h3><p>"+decodeURIComponent($(this).data("description"))+"</p>").show()}).on("mouseleave",function(){$(this).siblings("a").removeClass("faded");$("#fruit #fact").hide()}).on("click",function(e){e.preventDefault()})});